<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Сергеева - Задание 2</title>
</head>
<body>
    <main>
        <h1>Сергеева Екатерина P4110</h1>
        <form id="converterForm">
            <label for="surname">Введите фамилию:</label>
            <input type="text" id="surname" placeholder="Фамилия">
            <label for="amountRub">Сумма в рублях:</label>
            <input type="number" id="amountRub" placeholder="Сумма в рублях">

            <button type="submit">Конвертировать и отправить</button>

            <div id="result"></div>
        </form>
        <script>
            const FORM_ID = '1FAIpQLSc_sJpZ-t2y-Mt_HsDADgh4-et7OGLGFqZNXseLRQlGwciWoQ';
            const NAME_FIELD = 'entry.138719531';
            const AMOUNT_FIELD = 'entry.1949578643';

            const URL_FORM = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse`;

            document.getElementById('converterForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const surname = document.getElementById('surname').value.trim();
                const amountRub = document.getElementById('amountRub').value;
                const resultDiv = document.getElementById('result');

                resultDiv.textContent = 'Получаем курс ЦБ';

                const response = await fetch('https://www.cbr-xml-daily.ru/daily_json.js');
                const data = await response.json();
                const cnyRate = data.Valute.CNY.Value;

                const cnyAmount = (amountRub / cnyRate);

                console.log(cnyAmount)

                const formBody = new URLSearchParams();
                formBody.append(NAME_FIELD, surname);
                formBody.append(AMOUNT_FIELD, cnyAmount);

                await fetch(URL_FORM, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formBody
                    });

                resultDiv.textContent = 'Рубли конвертированы, результат записан в форму ' + cnyAmount;
            });
        </script>
    </main>
</body>
</html>